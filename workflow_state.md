# Воркфлоу для ВКР - Классификация клиентов Acoola по уровню лояльности

## State
- CurrentTaskID: TASK-005
- CurrentPhase: CONSTRUCT
- Status: IN_PROGRESS

## Task List
- [x] TASK-001: Анализ предметной области ритейла детской одежды (Status: DONE, Priority: High)
- [x] TASK-002: Обзор методов оценки и классификации клиентской лояльности (Status: DONE, Priority: High)
- [x] TASK-003: Исследовательский анализ данных (EDA) (Status: DONE, Priority: High)
- [x] TASK-004: Предобработка данных (Status: DONE, Priority: High)
- [ ] TASK-005: Разработка признака лояльности клиентов (Status: IN_PROGRESS, Priority: High)
- [ ] TASK-006: Создание и обучение моделей классификации (Status: TODO, Priority: High)
- [ ] TASK-007: Оптимизация и валидация моделей (Status: TODO, Priority: High)
- [ ] TASK-008: Проектирование архитектуры приложения (Status: TODO, Priority: Medium)
- [ ] TASK-009: Разработка бэкенда (Status: TODO, Priority: Medium)
- [ ] TASK-010: Разработка пользовательского интерфейса (Status: TODO, Priority: Medium)
- [ ] TASK-011: Тестирование и оптимизация приложения (Status: TODO, Priority: Medium)
- [ ] TASK-012: Оформление текста ВКР (Status: TODO, Priority: High)
- [ ] TASK-013: Подготовка презентационных материалов (Status: TODO, Priority: Medium)
- [ ] TASK-014: Поиск и обработка дополнительных данных (Status: TODO, Priority: Low, Optional)
- [ ] TASK-015: Оптимизация модели для промышленной эксплуатации (Status: TODO, Priority: Low)

## Current Task Plan
1. [x] Анализ существующего признака лояльности на основе RFM
2. [x] Определение дополнительных признаков, влияющих на лояльность
3. [x] Разработка формулы расчета целевого признака лояльности
4. [ ] Формирование дискретных категорий лояльности
5. [ ] Балансировка классов в целевом признаке
6. [ ] Оценка информативности признаков (feature importance)
7. [ ] Подготовка итогового размеченного датасета для моделирования

## Decisions & Log
[INIT-1] Инициализирован файл workflow_state.md с декомпозированным планом работ.
[TASK-001-1] Начата работа над анализом предметной области ритейла детской одежды. План составлен.
[TASK-001-2] Изучена бизнес-модель Acoola на основе данных из company_overview.md. Выявлены ключевые особенности: российский бренд детской одежды с сетью из более 170 магазинов, линейки одежды для детей 0-14 лет, размеры 92-170.
[TASK-001-3] Через веб-поиск получена информация о текущем состоянии рынка детской одежды в России. Выявлены тенденции: рост отечественных брендов после ухода международных в 2022 году, фокус на экологичность и технологичность.
[TASK-001-4] На основе данных из dataset_overview.md выявлены ключевые поля, важные для анализа клиентской лояльности: частота покупок, средний чек, баланс бонусов и другие.
[TASK-001-5] Созданы рекомендации для разработки модели классификации клиентов по лояльности. Предложена сегментация: высоколояльные, умеренно лояльные, низколояльные, потенциально лояльные, группа оттока.
[TASK-001-6] Задача выполнена. Результаты анализа оформлены в файле src/industry_analysis.md с подробным описанием компании Acoola, рынка детской одежды в России, системы лояльности и ключевых бизнес-метрик для оценки лояльности клиентов.
[TASK-002-1] Начата работа по обзору методов оценки и классификации клиентской лояльности. Составлен план исследования.
[TASK-002-2] Проведен анализ традиционных методов оценки лояльности (RFM, CLV, NPS и др.). Выявлены ключевые преимущества и ограничения каждого метода.
[TASK-002-3] Изучены методы машинного обучения для классификации клиентов по лояльности, включая алгоритмы классификации, кластеризации, ансамблевые методы и нейронные сети.
[TASK-002-4] Проанализированы комбинированные подходы к оценке лояльности, наиболее перспективным признан RFM + кластеризация и последующая классификация.
[TASK-002-5] Разработаны рекомендации по адаптации методов для ограниченного периода данных (1 месяц), включая модификации RFM, использование относительных метрик.
[TASK-002-6] Оформлен документ с обзором методов оценки и классификации клиентской лояльности (src/loyalty_methods_review.md), включающий теоретическую базу и практические рекомендации для проекта.
[TASK-002-7] Задача выполнена. Рекомендован комбинированный подход к оценке лояльности, включающий RFM-анализ, кластеризацию и ансамблевые методы машинного обучения.
[TASK-003-1] Начата работа по исследовательскому анализу данных (EDA). Составлен план действий из 7 шагов.
[TASK-003-2] Подготовлены инструменты для анализа данных: Python-скрипт (exploratory_data_analysis.py) и Python-скрипты (check_dataset.py, analyze_dataset.py) для исследования структуры и содержания датасета.
[TASK-003-3] Выявлены технические сложности с выполнением Python-скриптов в PowerShell. Датасет Concept202408.csv имеет размер около 113 МБ, содержит данные о клиентах, их покупках, использовании бонусов и других метриках.
[TASK-003-4] На основе описания полей в dataset_overview.md определены ключевые переменные для анализа лояльности: информация о клиентах, даты и суммы покупок, начисление и списание бонусов, частота покупок, средний чек.
[TASK-003-5] Создан документ с подробными рекомендациями по проведению исследовательского анализа данных (src/eda_guidelines.md), включающий пошаговые инструкции с фрагментами кода для анализа структуры данных, расчета статистических характеристик, визуализации распределений, проведения RFM-анализа и исследования взаимосвязей между переменными.
[TASK-003-6] Задача выполнена. В документе eda_guidelines.md представлены подробные рекомендации по анализу данных с акцентом на выявление ключевых факторов лояльности, временные паттерны, товарные предпочтения и использование бонусной программы. Подготовлен шаблон для проведения RFM-анализа и сегментации клиентов по уровню лояльности.
[TASK-004-1] Начата работа по предобработке данных. Составлен план действий из 7 шагов.
[TASK-004-2] Пустой файл exploratory_data_analysis.ipynb заменен на полноценный Python-скрипт exploratory_data_analysis.py, включающий все этапы исследовательского анализа данных со структурированными функциями. Удалены упоминания о Jupyter Notebook из рабочего процесса.
[TASK-004-3] Создан модуль data_preprocessing.py для комплексной предобработки данных. Модуль включает функции для обработки пропущенных значений (с использованием групповых и общих медиан/мод), обработки выбросов (метод IQR), нормализации числовых признаков (StandardScaler и MinMaxScaler), кодирования категориальных переменных (label encoding и one-hot encoding), создания агрегированных признаков на уровне клиента и подготовки итогового датасета с RFM-анализом и сегментацией клиентов по уровню лояльности.
[TASK-004-4] Реализована обработка выбросов в числовых переменных с использованием метода IQR (межквартильного размаха) и винсоризации экстремальных значений. Для каждой числовой переменной рассчитываются границы (Q1 - 1.5*IQR и Q3 + 1.5*IQR), и значения, выходящие за эти границы, заменяются граничными значениями.
[TASK-004-5] Реализована нормализация/стандартизация числовых признаков. Для денежных показателей применяется MinMaxScaler (масштабирование к диапазону [0,1]), для частотных переменных - StandardScaler (стандартизация с µ=0, σ=1).
[TASK-004-6] Разработана система кодирования категориальных переменных: для бинарных признаков (пол) применяется label encoding, для множественных категорий (точки продаж, товарные категории) - one-hot encoding с предварительной группировкой.
[TASK-004-7] Реализовано создание агрегированных данных на уровне клиента с расчетом ключевых метрик лояльности: recency (давность последней покупки), frequency (частота покупок), monetary (общая сумма покупок), а также дополнительных признаков: среднего чека, процента использования бонусов, периода активности клиента и др.
[TASK-004-8] Реализован RFM-анализ с квантильным подходом и разработана классификация клиентов по уровню лояльности на основе RFM-оценок: "Высоколояльные", "Лояльные", "Умеренно лояльные", "Низколояльные" и "Отток".
[TASK-004-9] Создан демонстрационный скрипт preprocess_data_demo.py для запуска процесса предобработки и визуализации результатов. Скрипт включает функции для отображения распределений переменных до обработки, визуализации RFM-сегментов и корреляционной матрицы признаков.
[TASK-004-10] Задача выполнена. Разработан полноценный модуль предобработки данных, который выполняет все необходимые шаги для подготовки датасета к моделированию, включая обработку пропущенных значений, выбросов, нормализацию, кодирование категорий, агрегацию данных и создание RFM-сегментов лояльности.
[TASK-005-1] Начата работа по разработке признака лояльности клиентов. Составлен план действий из 7 шагов.
[TASK-005-2] Проанализирован существующий признак лояльности на основе RFM. Выявлены ограничения: равные веса для R, F и M, отсутствие учета дополнительных факторов лояльности, базовая сегментация на 5 категорий.
[TASK-005-3] Определены дополнительные признаки, влияющие на лояльность: разнообразие категорий товаров, активность использования бонусов, реакция на акции, сезонность покупок, параметры покупаемых товаров, средний период между покупками и другие.
[TASK-005-4] Фаза анализа завершена. На основе изучения существующего решения и рекомендаций из документа loyalty_methods_review.md решено разработать комбинированный подход к оценке лояльности, включающий расширенную RFM-модель, дополнительные признаки и кластеризацию.
[TASK-005-5] Разработана формула расчета целевого признака лояльности, состоящая из двух компонентов: 1) базовая составляющая (weighted_RFM с разными весами для R, F и M - 0.5, 0.3, 0.2 соответственно), 2) бонусная составляющая (учитывает использование бонусов, разнообразие категорий, стабильность покупок, локальную лояльность и штраф за давность последней покупки). Формула имеет вид: loyalty_score = (base_component * 0.7 + bonus_component).clip(0, 1).
[TASK-005-6] Создан модуль enhanced_loyalty_features.py, включающий функции для расчета расширенных признаков лояльности, кластеризации клиентов, расчета комбинированной метрики лояльности и подготовки итогового датасета для моделирования.
[TASK-005-7] Разработан демонстрационный скрипт loyalty_demo.py для визуализации сравнения базового RFM-метода и улучшенного метода оценки лояльности. Скрипт создает несколько типов визуализаций: распределение клиентов по категориям, матрицу сравнения категорий, распределение оценок лояльности, диаграмму рассеяния RFM vs улучшенная оценка, визуализацию кластеров и важность признаков.

## Детальный план задач

### ЭТАП 1: ИССЛЕДОВАТЕЛЬСКИЙ АНАЛИЗ

**TASK-001: Анализ предметной области ритейла детской одежды**
- Исследование бизнес-модели Acoola и особенностей рынка
- Анализ существующей системы лояльности компании
- Выявление ключевых бизнес-метрик
- **Технологии**: аналитические методы, обзор литературы
- **Результат**: раздел ВКР с описанием предметной области и бизнес-контекста
- **Зависимость**: Нет

**TASK-002: Обзор методов оценки и классификации клиентской лояльности**
- Изучение научных публикаций по классификации клиентов
- Анализ существующих метрик лояльности (RFM, CLV и др.)
- Обзор современных подходов ML к задачам классификации клиентов
- **Технологии**: обзор научной литературы
- **Результат**: обоснование выбора метрик и методов для работы
- **Зависимость**: Нет

**TASK-003: Исследовательский анализ данных (EDA)**
- Загрузка и первичный анализ структуры данных
- Статистический анализ и визуализация распределений
- Выявление паттернов и корреляций
- Анализ выбросов и аномалий
- **Технологии**: Python, pandas, matplotlib, seaborn
- **Результат**: Python-скрипт с EDA, набор инсайтов о данных
- **Зависимость**: Частично TASK-001

### ЭТАП 2: РАЗРАБОТКА МОДЕЛЕЙ МАШИННОГО ОБУЧЕНИЯ

**TASK-004: Предобработка данных**
- Обработка пропущенных значений
- Обработка выбросов
- Нормализация/стандартизация числовых признаков
- Кодирование категориальных признаков
- **Технологии**: Python, pandas, scikit-learn
- **Результат**: очищенный датасет, готовый к моделированию
- **Зависимость**: TASK-003

**TASK-005: Разработка признака лояльности клиентов**
- Создание набора потенциальных признаков лояльности
- Определение формулы расчета целевого признака
- Генерация категорий лояльности (например, низкая/средняя/высокая)
- **Технологии**: Python, pandas, бизнес-метрики (из TASK-002)
- **Результат**: размеченный датасет с целевым признаком
- **Зависимость**: TASK-002, TASK-004

**TASK-006: Создание и обучение моделей классификации**
- Разделение данных на обучающую и тестовую выборки
- Реализация базовых моделей:
  - Логистическая регрессия
  - Random Forest
  - Gradient Boosting (XGBoost/LightGBM)
  - SVM
- Базовая оценка моделей
- **Технологии**: scikit-learn, XGBoost, LightGBM
- **Результат**: набор обученных моделей-кандидатов
- **Зависимость**: TASK-005

**TASK-007: Оптимизация и валидация моделей**
- Настройка гиперпараметров (Grid/Random Search)
- Кросс-валидация моделей
- Сравнительный анализ качества (метрики precision, recall, F1)
- Анализ важности признаков
- Интерпретация результатов
- **Технологии**: scikit-learn, optuna, SHAP/LIME для интерпретации
- **Результат**: оптимизированная модель с лучшими метриками
- **Зависимость**: TASK-006

### ЭТАП 3: РАЗРАБОТКА ПРИЛОЖЕНИЯ

**TASK-008: Проектирование архитектуры приложения**
- Определение функциональных требований
- Выбор технологического стека
- Проектирование компонентной структуры
- Разработка API-интерфейсов
- **Технологии**: UML, документирование архитектуры
- **Результат**: архитектурная документация приложения
- **Зависимость**: TASK-001, TASK-002

**TASK-009: Разработка бэкенда**
- Создание базовой структуры проекта
- Реализация API для взаимодействия с ML-моделью
- Сериализация и интеграция обученной модели
- Реализация бизнес-логики и хранения данных
- **Технологии**: Python, Flask/FastAPI, SQLite/PostgreSQL, pickle/joblib
- **Результат**: функционирующий бэкенд с ML-функциональностью
- **Зависимость**: TASK-007, TASK-008

**TASK-010: Разработка пользовательского интерфейса**
- Проектирование UI/UX дизайна
- Разработка интерфейса для аналитических дашбордов
- Имплементация форм для работы с данными клиентов
- Интеграция с бэкендом через API
- **Технологии**: HTML/CSS/JS, React/Vue.js, Chart.js/D3.js
- **Результат**: работающий интерфейс приложения
- **Зависимость**: TASK-008, может начаться параллельно с TASK-009

**TASK-011: Тестирование и оптимизация приложения**
- Функциональное тестирование
- Тестирование производительности
- Исправление выявленных ошибок
- Оптимизация UX и производительности
- **Технологии**: инструменты тестирования (pytest, jest)
- **Результат**: стабильная версия приложения
- **Зависимость**: TASK-009, TASK-010

### ЭТАП 4: ДОКУМЕНТИРОВАНИЕ

**TASK-012: Оформление текста ВКР**
- Написание введения и постановки задачи
- Оформление методологической части
- Написание практической части (результаты)
- Формулирование выводов и заключения
- Оформление приложений и библиографии
- **Технологии**: MS Word/LaTeX
- **Результат**: полный текст ВКР, готовый к защите
- **Зависимость**: Все предыдущие задачи (работа ведется параллельно)

**TASK-013: Подготовка презентационных материалов**
- Разработка презентации для защиты
- Подготовка демонстрационных скриптов
- Составление речи для защиты
- **Технологии**: PowerPoint/Google Slides
- **Результат**: презентация и сопроводительные материалы
- **Зависимость**: TASK-012

### ДОПОЛНИТЕЛЬНЫЕ ЗАДАЧИ

**TASK-014: Поиск и обработка дополнительных данных (при необходимости)**
- Сбор дополнительных данных из открытых источников
- Интеграция с основным датасетом
- **Технологии**: API, web-scraping, pandas
- **Результат**: расширенный датасет
- **Зависимость**: TASK-003

**TASK-015: Оптимизация модели для промышленной эксплуатации**
- Оптимизация кода модели
- Упаковка в Docker-контейнер
- Разработка сценариев переобучения
- **Технологии**: Docker, CI/CD, MLFlow
- **Результат**: готовое к промышленной эксплуатации ML-решение
- **Зависимость**: TASK-007