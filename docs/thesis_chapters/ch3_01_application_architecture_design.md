# Глава 3. Разработка приложения (с фокусом на архитектуру)

## 3.1 Проектирование архитектуры приложения

Для обеспечения эффективного взаимодействия с разработанной моделью машинного обучения и демонстрации ее возможностей была спроектирована архитектура программного решения. Основной целью архитектурного проектирования являлось создание гибкой, масштабируемой и поддерживаемой системы, даже при условии реализации только минимально необходимого функционала для демонстрации в рамках данной работы.

### 3.1.1 Общее описание архитектурного решения

Предлагаемая система классификации клиентов Acoola спроектирована с использованием API-first подхода и ориентирована на четкое разделение ответственности между компонентами. В основе лежит многокомпонентная архитектура, где каждый основной блок выполняет свою специфическую роль.

**Ключевые компоненты системы:**

1.  **API Сервис (Backend):**
    *   **Назначение:** Является ядром системы, обрабатывает все входящие запросы, управляет бизнес-логикой, взаимодействует с базой данных, хранилищем файлов и модулем машинного обучения. Предоставляет RESTful API для взаимодействия с внешними системами и пользовательским интерфейсом.
    *   **Технологии:** Реализован на Python с использованием фреймворка FastAPI, который обеспечивает высокую производительность, автоматическую валидацию данных на основе Pydantic-схем и генерацию интерактивной API-документации (Swagger UI / ReDoc).

2.  **Модуль Машинного Обучения (ML Service/Module):**
    *   **Назначение:** Инкапсулирует логику работы с ML-моделями. Отвечает за загрузку обученной модели (например, из `.pkl` файла), предобработку входных данных в формат, ожидаемый моделью, выполнение предсказаний (классификации) и возврат результатов. В рамках текущей реализации, ML-логика может быть тесно интегрирована с API Сервисом или выделена в отдельный логический модуль.
    *   **Технологии:** Python, библиотеки `scikit-learn`, `pandas`, `numpy`, `joblib`/`pickle` для загрузки моделей.

3.  **Пользовательский Интерфейс (Frontend):**
    *   **Назначение:** Предоставляет пользователю (например, аналитику) возможность взаимодействия с системой для демонстрации ее работы. Включает формы для ручного ввода данных или загрузки CSV-файла с клиентскими данными, отображение информации об активной модели, визуализацию распределения клиентов по сегментам лояльности и представление результатов классификации.
    *   **Технологии:** Для минимизации сложности и обеспечения быстрой разработки, интерфейс реализован с использованием HTML-шаблонов (Jinja2), обслуживаемых FastAPI, с базовым стилистическим оформлением (CSS) и, при необходимости, минимальным использованием JavaScript для интерактивности.

4.  **База Данных (например, PostgreSQL):**
    *   **Назначение:** Хранение структурированных данных, таких как информация о пользователях (если предполагается аутентификация), метаданные ML-моделей, возможно, история классификаций или агрегированные данные клиентов, если это необходимо для расширенного функционала. В минимальной конфигурации для демонстрации ее использование может быть ограничено.
    *   **Технологии:** Реляционная СУБД, например, PostgreSQL. Взаимодействие из Python может осуществляться через ORM (например, SQLAlchemy).

5.  **Хранилище Файлов (например, локальная ФС или MinIO):**
    *   **Назначение:** Хранение сериализованных ML-моделей, артефактов предобработки (скейлеры, энкодеры), а также загружаемых пользователем файлов с данными и, возможно, генерируемых отчетов.
    *   **Технологии:** Локальная файловая система для простоты развертывания или S3-совместимое хранилище (например, MinIO) для большей гибкости.

**Взаимодействие компонентов:**
Пользователь взаимодействует с системой через Пользовательский Интерфейс, который отправляет запросы к API Сервису. API Сервис, в свою очередь, обрабатывает запрос, при необходимости обращается к Модулю Машинного Обучения для получения предсказания, может взаимодействовать с Базой Данных и Хранилищем Файлов, после чего возвращает ответ Пользовательскому Интерфейсу. Интерактивная документация API (Swagger UI), предоставляемая FastAPI, также служит важным инструментом для разработчиков и аналитиков.

### 3.1.2 Структура кода и основные модули

Проект имеет модульную структуру, направленную на логическое разделение функциональности и упрощение поддержки. Основная структура директорий и файлов выглядит следующим образом:

*   **`src/`**: Корневая директория с исходным кодом приложения.
    *   `main.py`: Точка входа в приложение FastAPI, инициализация основных компонентов, подключение роутеров.
    *   **`api/`**: Модули, связанные с реализацией API.
        *   `routes/`: Определения эндпоинтов API (маршрутов). Например, `ui_routes.py` для обслуживания запросов от пользовательского интерфейса и выполнения классификации.
        *   `schemas/` (если используется): Pydantic-схемы для валидации данных запросов и ответов.
    *   **`modeling/`**: Модули, связанные с разработкой и использованием ML-моделей.
        *   `models/`: Содержит реализации классов для различных алгоритмов машинного обучения.
        *   `optimization/`: Модули для оптимизации гиперпараметров моделей (например, с использованием Optuna).
        *   `evaluation/`: Функции и классы для оценки качества моделей.
        *   `interpretation/`: Инструменты для интерпретации моделей (например, SHAP).
        *   `model_training.py`: Скрипт или модуль для оркестрации процесса обучения и оценки моделей.
    *   **`preprocessing/`**: Модули для предобработки данных и конструирования признаков.
        *   `cleaners/`, `encoders/`, `feature_engineering/`: Модули, реализующие специфические шаги предобработки.
        *   `data_preprocessing.py`: Основной модуль, агрегирующий шаги предобработки.
        *   `enhanced_loyalty_features.py`: Модуль для расчета расширенных признаков лояльности.
    *   **`utils/`**: Вспомогательные утилиты (например, для работы с конфигурацией, логированием, общие хелперы).
    *   **`static/`**: Статические файлы для frontend (CSS, JavaScript, изображения).
    *   **`templates/`**: HTML-шаблоны (Jinja2) для пользовательского интерфейса.
*   **`dataset/`**: Директория для хранения исходных наборов данных.
*   **`output/`**: Директория для сохранения результатов работы пайплайнов:
    *   `models/`: Сохраненные обученные модели, трансформеры.
    *   `results/`: Таблицы с метриками, текстовые отчеты, логи.
    *   `feature_importance/`: Данные и визуализации по важности признаков.
    *   `visualizations/`: Общие визуализации, генерируемые в ходе анализа данных.
*   **`docs/`**: Документация проекта.
    *   `business/`: Бизнес-описание.
    *   `technical/`: Техническая документация, включая описание архитектуры (`architecture/application_architecture.md`), обзор визуализаций.
    *   `thesis_chapters/`: Markdown-файлы с текстом глав ВКР.
*   **`tests/`**: Модульные, интеграционные и e2e тесты (структура может варьироваться).
*   `requirements.txt`: Список зависимостей проекта.
*   `run_pipeline.py`: Основной скрипт для запуска полного конвейера обработки данных и обучения моделей.

Такая структура обеспечивает хорошее разделение ответственности (Separation of Concerns) и способствует более легкой навигации по кодовой базе, ее тестированию и дальнейшему развитию. 